
{
  "data": [
    {
      "title": "Linux系统收发网络数据包的过程",
      "paragraphs": [
        {
          "context": "Linux网络协议栈基于TCP/IP模型，分为应用层、传输层、网络层和网络接口层。",
          "qas": [
            {
              "question": "Linux网络协议栈基于什么模型？分为哪几层？",
              "id": "3-108-1",
              "answers": [
                {
                  "text": "TCP/IP模型，分为应用层、传输层、网络层和网络接口层。",
                  "answer_start": 11
                }
              ]
            }
          ]
        },
        {
          "context": "应用层为用户提供FTP、Telnet、DNS、SMTP等服务。",
          "qas": [
            {
              "question": "应用层提供哪些服务？",
              "id": "3-108-2",
              "answers": [
                {
                  "text": "FTP、Telnet、DNS、SMTP等服务。",
                  "answer_start": 14
                }
              ]
            }
          ]
        },
        {
          "context": "传输层定义了TCP和UDP协议，提供端到端通信功能。",
          "qas": [
            {
              "question": "传输层有哪些主要协议？",
              "id": "3-108-3",
              "answers": [
                {
                  "text": "TCP和UDP协议。",
                  "answer_start": 10
                }
              ]
            }
          ]
        },
        {
          "context": "网络层解决主机到主机通信，有IP、IGMP、ICMP协议。",
          "qas": [
            {
              "question": "网络层的主要作用是什么？包含哪些协议？",
              "id": "3-108-4",
              "answers": [
                {
                  "text": "解决主机到主机的通信问题，包含IP、IGMP、ICMP协议。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "网络接口层对应OSI物理层和数据链路层，ARP工作在此层。",
          "qas": [
            {
              "question": "网络接口层对应OSI的哪些层？什么协议工作在此层？",
              "id": "3-108-5",
              "answers": [
                {
                  "text": "物理层和数据链路层，ARP协议工作在此层。",
                  "answer_start": 11
                }
              ]
            }
          ]
        },
        {
          "context": "网络数据包到达网卡后，存入接收队列，通过DMA写入Ring Buffer。",
          "qas": [
            {
              "question": "网络数据包到达网卡后如何处理？",
              "id": "3-108-6",
              "answers": [
                {
                  "text": "存入接收队列，通过DMA写入Ring Buffer。",
                  "answer_start": 19
                }
              ]
            }
          ]
        },
        {
          "context": "网卡向CPU发起硬件中断，CPU找到中断处理函数。",
          "qas": [
            {
              "question": "网卡收到数据包后会向CPU做什么？CPU如何响应？",
              "id": "3-108-7",
              "answers": [
                {
                  "text": "发起硬件中断，CPU根据中断注册表找到注册的中断处理函数。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "硬件中断处理函数会屏蔽网卡中断，发起软中断后恢复中断。",
          "qas": [
            {
              "question": "硬件中断处理函数会做哪些事情？",
              "id": "3-108-8",
              "answers": [
                {
                  "text": "屏蔽网卡的中断，发起软中断，恢复刚才屏蔽的中断。",
                  "answer_start": 16
                }
              ]
            }
          ]
        },
        {
          "context": "ksoftirqd线程收到软中断后，调用处理函数轮询处理数据，将网络包交协议栈。",
          "qas": [
            {
              "question": "ksoftirqd线程收到软中断后会做什么？",
              "id": "3-108-9",
              "answers": [
                {
                  "text": "调用相应软中断的处理函数来轮询处理数据，将网络包交给网络协议栈处理。",
                  "answer_start": 19
                }
              ]
            }
          ]
        },
        {
          "context": "网络接口层检查报文合法性，找出上层协议类型，去掉帧头帧尾交网络层。",
          "qas": [
            {
              "question": "网络接口层如何处理网络包？",
              "id": "3-108-10",
              "answers": [
                {
                  "text": "检查报文的合法性和正确性，找出上层协议的类型，去掉帧头、帧尾，交给网络层处理。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "网络层确认网络包给本机后，取出上层协议类型，去掉IP头交传输层。",
          "qas": [
            {
              "question": "网络层处理网络包的流程是什么？",
              "id": "3-108-11",
              "answers": [
                {
                  "text": "取出IP头，判断网络包走向，确认给本机后，取出上层协议类型，去掉IP头，交给传输层处理。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "传输层根据四元组找出对应Socket，将数据拷贝到其接收缓冲区。",
          "qas": [
            {
              "question": "传输层如何处理数据并交给应用层？",
              "id": "3-108-12",
              "answers": [
                {
                  "text": "取出TCP头或者UDP头后，根据四元组找出对应的Socket，把数据拷贝到Socket的接收缓冲区。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "应用层程序调用Socket接口，将内核接收缓冲区数据拷贝到应用层缓冲区。",
          "qas": [
            {
              "question": "应用层如何获取数据？",
              "id": "3-108-13",
              "answers": [
                {
                  "text": "调用Socket接口，将内核的Socket接收缓冲区的数据拷贝到应用层的缓冲区。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "应用程序调用Socket发送接口，从用户态陷入内核态套接字层。",
          "qas": [
            {
              "question": "应用程序发送网络包的第一步是什么？",
              "id": "3-108-14",
              "answers": [
                {
                  "text": "调用Socket发送网络包的接口，从用户态陷入到内核态的套接字层中。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "套接字层申请sk_buff内存，拷贝用户数据，加入Socket发送缓冲区。",
          "qas": [
            {
              "question": "套接字层在发送流程中做什么？",
              "id": "3-108-15",
              "answers": [
                {
                  "text": "申请一个内核态的sk_buff内存，将用户待发送的数据拷贝到sk_buff内存，并将其加入到Socket发送缓冲区等待网络协议栈的处理。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "传输层为数据包添加TCP头，拷贝sk_buff副本以支持重传。",
          "qas": [
            {
              "question": "传输层在发送数据包时做了什么？",
              "id": "3-108-16",
              "answers": [
                {
                  "text": "为其添加TCP头，同时拷贝一个新的sk_buff副本，以确保网络包可靠传输。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "网络层选取路由、填充IP头、过滤、分片后交网络接口层。",
          "qas": [
            {
              "question": "网络层处理发送的数据包包括哪些工作？",
              "id": "3-108-17",
              "answers": [
                {
                  "text": "选取路由、填充IP头、netfilter过滤、对超过MTU大小的数据包进行分片，然后交给网络接口层处理。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "网络接口层找下一跳MAC地址，填充帧头帧尾，放发送队列，触发软中断。",
          "qas": [
            {
              "question": "网络接口层如何处理要发送的数据包？",
              "id": "3-108-18",
              "answers": [
                {
                  "text": "进行物理地址寻址找到下一跳的MAC地址，填充帧头和帧尾，将其放到发送队列中，然后触发软中断告诉网卡驱动程序。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "网卡从FIFO发送队列取数据包发送，完成后发硬中断释放内存。",
          "qas": [
            {
              "question": "网卡设备如何发送数据包及后续处理？",
              "id": "3-108-19",
              "answers": [
                {
                  "text": "从FIFO发送队列中取出数据包发送到网络，发送完成后触发硬中断释放内存，包括释放sk_buff内存和清理RingBuffer内存。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "收到TCP报文的ACK应答时，传输层释放原始的sk_buff。",
          "qas": [
            {
              "question": "传输层何时释放原始的sk_buff？",
              "id": "3-108-20",
              "answers": [
                {
                  "text": "当收到这个TCP报文的ACK应答时。",
                  "answer_start": 0
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}