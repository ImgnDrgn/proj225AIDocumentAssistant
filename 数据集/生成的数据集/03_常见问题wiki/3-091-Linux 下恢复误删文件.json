{
  "data": [
    {
      "title": "Linux 下恢复误删文件",
      "paragraphs": [
        {
          "context": "本文来自论坛用户littlebat在论坛中的分享《Linux 下恢复误删文件》，首发于学习日记。",
          "qas": [
            {
              "question": "本文来自谁的分享？",
              "id": "3-90-1",
              "answers": [
                {
                  "text": "论坛用户littlebat",
                  "answer_start": 5
                }
              ]
            },
            {
              "question": "本文的首发地址是什么？",
              "id": "3-90-2",
              "answers": [
                {
                  "text": "学习日记 https://www.learndiary.com/2022/09/linux-file-recovery/",
                  "answer_start": 39
                }
              ]
            }
          ]
        },
        {
          "context": "客户在 Ubuntu Linux（约20.04）下用 rm 命令误删重要文件夹文件，后在同分区装数据恢复软件恢复失败，找人恢复不理想后再联系作者。",
          "qas": [
            {
              "question": "客户误删文件的操作系统是什么？",
              "id": "3-90-3",
              "answers": [
                {
                  "text": "Ubuntu Linux（版本大概是20.04）",
                  "answer_start": 5
                }
              ]
            },
            {
              "question": "客户用什么命令误删了文件？",
              "id": "3-90-4",
              "answers": [
                {
                  "text": "rm",
                  "answer_start": 42
                }
              ]
            }
          ]
        },
        {
          "context": "恢复时先长按电源键关电脑，用向日葵远程到Windows系统制作Ubuntu的U盘Live系统，从U盘启动后安装向日葵远程操作，操作时未挂载硬盘分区。",
          "qas": [
            {
              "question": "误删文件后，首先对电脑进行了什么操作？",
              "id": "3-90-5",
              "answers": [
                {
                  "text": "长按电源键关闭电脑",
                  "answer_start": 5
                }
              ]
            },
            {
              "question": "恢复操作时使用的系统是什么？",
              "id": "3-90-6",
              "answers": [
                {
                  "text": "Ubuntu 的 U 盘 Live 系统",
                  "answer_start": 36
                }
              ]
            },
            {
              "question": "恢复操作时硬盘分区是否挂载？",
              "id": "3-90-7",
              "answers": [
                {
                  "text": "未挂载",
                  "answer_start": 79
                }
              ]
            }
          ]
        },
        {
          "context": "用lsblk -f查看磁盘分区，客户有单独的/home分区，格式ext4，被删文件位于家目录文件夹，假设分区是/dev/sda3。",
          "qas": [
            {
              "question": "用什么命令查看磁盘分区情况？",
              "id": "3-90-8",
              "answers": [
                {
                  "text": "lsblk -f",
                  "answer_start": 1
                }
              ]
            },
            {
              "question": "客户的/home分区格式是什么？",
              "id": "3-90-9",
              "answers": [
                {
                  "text": "ext4",
                  "answer_start": 41
                }
              ]
            }
          ]
        },
        {
          "context": "在Live系统安装testdisk和ext4magic，执行sudo testdisk /dev/sda验证删除数据位置和时间，退出后挂载另一个分区存储恢复数据，假设为/dev/sda1，切换到/mnt/tmp执行恢复命令。",
          "qas": [
            {
              "question": "恢复过程中安装了哪些软件？",
              "id": "3-90-10",
              "answers": [
                {
                  "text": "testdisk 和 ext4magic",
                  "answer_start": 18
                }
              ]
            },
            {
              "question": "执行什么命令验证删除数据的位置和时间？",
              "id": "3-90-11",
              "answers": [
                {
                  "text": "sudo testdisk /dev/sda",
                  "answer_start": 42
                }
              ]
            },
            {
              "question": "用于存储恢复数据的分区假设是什么？",
              "id": "3-90-12",
              "answers": [
                {
                  "text": "/dev/sda1",
                  "answer_start": 97
                }
              ]
            }
          ]
        },
        {
          "context": "恢复命令为sudo ext4magic /dev/sda3 -a \"$(date -d \"2022-09-25 15:00:00\" +%s)\" -r，恢复2022年9月25日15点后删除的文件，文件保存在RECOVERDIR中，原路径找不到，有效文件在RECOVERDIR/MAGIC-2下，无原目录结构和文件名。",
          "qas": [
            {
              "question": "恢复2022年9月25日15点后删除文件的命令是什么？",
              "id": "3-90-13",
              "answers": [
                {
                  "text": "sudo ext4magic /dev/sda3 -a \"$(date -d \"2022-09-25 15:00:00\" +%s)\" -r",
                  "answer_start": 0
                }
              ]
            },
            {
              "question": "恢复的文件保存在哪里？",
              "id": "3-90-14",
              "answers": [
                {
                  "text": "RECOVERDIR",
                  "answer_start": 101
                }
              ]
            },
            {
              "question": "有效恢复文件位于哪个目录下？",
              "id": "3-90-15",
              "answers": [
                {
                  "text": "RECOVERDIR/MAGIC-2",
                  "answer_start": 142
                }
              ]
            }
          ]
        },
        {
          "context": "恢复的python文件在RECOVERDIR/MAGIC-2/text/x-script.python，.rmf文件在RECOVERDIR/MAGIC-2/application/octet-stream，通过文件内容关键字寻找，如python文件引用“specialpackage”，.rmf文件有“mykeyinhead”。",
          "qas": [
            {
              "question": "恢复的python文件位于哪个目录？",
              "id": "3-90-16",
              "answers": [
                {
                  "text": "RECOVERDIR/MAGIC-2/text/x-script.python",
                  "answer_start": 5
                }
              ]
            },
            {
              "question": ".rmf文件位于哪个目录？",
              "id": "3-90-17",
              "answers": [
                {
                  "text": "RECOVERDIR/MAGIC-2/application/octet-stream",
                  "answer_start": 48
                }
              ]
            },
            {
              "question": "python文件通常引用的特殊包是什么？",
              "id": "3-90-18",
              "answers": [
                {
                  "text": "specialpackage",
                  "answer_start": 127
                }
              ]
            },
            {
              "question": ".rmf文件开头特有的关键字是什么？",
              "id": "3-90-19",
              "answers": [
                {
                  "text": "mykeyinhead",
                  "answer_start": 200
                }
              ]
            }
          ]
        },
        {
          "context": "数据恢复结果：在有错误数据覆盖操作下，找回很多python文件和一些rmf文件，客户基本满意。",
          "qas": [
            {
              "question": "数据恢复的结果如何？",
              "id": "3-90-20",
              "answers": [
                {
                  "text": "在有错误数据覆盖操作下，找回很多python文件和一些rmf文件，客户基本满意。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "数据误删恢复小结1：重要数据要在不同介质备份。",
          "qas": [
            {
              "question": "数据误删恢复小结中关于重要数据的建议是什么？",
              "id": "3-90-21",
              "answers": [
                {
                  "text": "重要的数据要在不同的介质备份。",
                  "answer_start": 0
                }
              ]
            }
          ]
        },
        {
          "context": "小结2：误删数据后不要往相同分区作写入操作，可直接卸载的分区直接卸载，有自动写入的分区建议长按电源键关电脑。",
          "qas": [
            {
              "question": "误删数据后对相同分区的操作建议是什么？",
              "id": "3-90-22",
              "answers": [
                {
                  "text": "不要往相同分区作写入操作",
                  "answer_start": 5
                }
              ]
            },
            {
              "question": "对于有自动写入操作的分区，误删数据后建议如何处理？",
              "id": "3-90-23",
              "answers": [
                {
                  "text": "建议直接按住电源按纽数秒关闭电脑。",
                  "answer_start": 56
                }
              ]
            }
          ]
        },
        {
          "context": "小结3：可直接卸载的分区可在电脑上装恢复软件恢复；系统启动后会写操作的分区用Live Linux启动恢复。",
          "qas": [
            {
              "question": "可直接卸载的分区如何恢复数据？",
              "id": "3-90-24",
              "answers": [
                {
                  "text": "可以直接在电脑上安装恢复软件进行恢复",
                  "answer_start": 1
                }
              ]
            },
            {
              "question": "系统启动后会直接作写操作的分区如何恢复数据？",
              "id": "3-90-25",
              "answers": [
                {
                  "text": "用 Live Linux 启动进行恢复操作。",
                  "answer_start": 53
                }
              ]
            }
          ]
        },
        {
          "context": "小结4：尝试用photorec恢复，其根据文件类型特征逐扇区扫描，可指定特定类型文件，因移动硬盘IO错误中断，且ext4magic效果达预期而放弃。",
          "qas": [
            {
              "question": "photorec是如何恢复文件的？",
              "id": "3-90-26",
              "answers": [
                {
                  "text": "根据文件类型的特征，逐扇区扫描硬盘找回删除的文件。",
                  "answer_start": 18
                }
              ]
            },
            {
              "question": "为什么放弃使用photorec恢复文件？",
              "id": "3-90-27",
              "answers": [
                {
                  "text": "客户找的用于保存数据的移动硬盘中途出现IO错误导致恢复中断，另外，通过ext4magic找回的文件可能已经达到了客户的心理预期。",
                  "answer_start": 67
                }
              ]
            }
          ]
        },
        {
          "context": "小结5：新版本操作系统（如Ubuntu 20.04）的ext4文件系统中，通过文件系统日志恢复删除文件不能保留原文件名，旧版本（如Ubuntu 16.04）可以，测试多种软件效果相同，extundelete不工作。",
          "qas": [
            {
              "question": "在Ubuntu 20.04的ext4文件系统中，通过文件系统日志恢复删除的文件能否保留原文件名？",
              "id": "3-90-28",
              "answers": [
                {
                  "text": "不能",
                  "answer_start": 75
                }
              ]
            },
            {
              "question": "哪个版本的Ubuntu系统的ext4文件系统恢复删除文件可以保留原文件名和目录结构？",
              "id": "3-90-29",
              "answers": [
                {
                  "text": "Ubuntu 16.04",
                  "answer_start": 96
                }
              ]
            },
            {
              "question": "在测试的恢复软件中，哪个软件不工作？",
              "id": "3-90-30",
              "answers": [
                {
                  "text": "extundelete",
                  "answer_start": 177
                }
              ]
            }
          ]
        },
        {
          "context": "参考资料包括Unix/Linux undelete/recover deleted files、File recovery、Ext4magic、TestDisk、PhotoRec的相关链接。",
          "qas": [
            {
              "question": "数据恢复的参考资料有哪些？",
              "id": "3-90-31",
              "answers": [
                {
                  "text": "1. Unix/Linux undelete/recover deleted files https://unix.stackexchange.com/questions/80270/unix-linux-undelete-recover-deleted-files；2. File recovery https://wiki.archlinux.org/title/File_recovery；3. Ext4magic https://ext4magic.sourceforge.net/ext4magic_en.html；4. TestDisk https://www.cgsecurity.org/wiki/TestDisk_CN；5. PhotoRec https://www.cgsecurity.org/wiki/PhotoRec_CN",
                  "answer_start": 0
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}