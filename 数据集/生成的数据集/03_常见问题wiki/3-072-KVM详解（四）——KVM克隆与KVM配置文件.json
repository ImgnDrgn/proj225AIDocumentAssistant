{
  "data": [
    {
      "title": "KVM详解（四）——KVM克隆与KVM配置文件",
      "paragraphs": [
        {
          "context": "KVM支持虚拟机克隆，所谓虚拟机克隆，就是由一台指定的虚拟机生成另一台与其完全相同的虚拟机。KVM虚拟机克隆命令格式为：virt-clone -o 【原虚拟机】 -n 【新虚拟机】 -f 【新虚拟机镜像名（含路径）。例如，我们要把之前的centos7-1虚拟机进行克隆，如下（centos7-1.qcow2）所示：那么就可以执行命令：virt-clone -o centos7-1 -n centos7-2 -f /var/lib/libvirt/images/centos7-2.img。注意，-o参数后面跟的是原虚拟机的名称，而不要跟镜像格式，即需要把后面的后缀.qcow2去掉，-n跟的是新的虚拟机名称，-f跟的是新的虚拟机的路径加上文件名。",
          "qas": [
            {
              "id": "3-72-1",
              "question": "KVM虚拟机克隆的命令格式是什么？",
              "answers": [
                {
                  "text": "virt-clone -o 【原虚拟机】 -n 【新虚拟机】 -f 【新虚拟机镜像名（含路径）",
                  "answer_start": 39
                }
              ]
            },
            {
              "id": "3-72-2",
              "question": "克隆centos7-1虚拟机为centos7-2，且新镜像路径为/var/lib/libvirt/images/centos7-2.img，应执行什么命令？",
              "answers": [
                {
                  "text": "virt-clone -o centos7-1 -n centos7-2 -f /var/lib/libvirt/images/centos7-2.img",
                  "answer_start": 156
                }
              ]
            },
            {
              "id": "3-72-3",
              "question": "-o参数后面跟什么内容？",
              "answers": [
                {
                  "text": "原虚拟机的名称，而不要跟镜像格式，即需要把后面的后缀.qcow2去掉",
                  "answer_start": 259
                }
              ]
            },
            {
              "id": "3-72-4",
              "question": "-n参数和-f参数分别跟什么内容？",
              "answers": [
                {
                  "text": "-n跟的是新的虚拟机名称，-f跟的是新的虚拟机的路径加上文件名",
                  "answer_start": 335
                }
              ]
            }
          ]
        },
        {
          "context": "尽管上面我们成功克隆了一台KVM的虚拟机并成功运行，但是有一定计算机基础的小伙伴一定会问，这台虚拟机会不会与之前被克隆的虚拟机冲突的问题。该问题是非常有可能发生的，并且也必须引起我们的重视。尽管我们在进行虚拟机克隆时，希望能够完全按照原始虚拟机的配置进行克隆。但是，有时候配置完全相同却并不是一件好事！例如，我们并不希望两台虚拟的MAC地址相同，因为这会造成局域网内MAC地址冲突。此外，还有一些牵扯到网卡的配置文件等，我们也不希望克隆后的虚拟机和克隆前的虚拟机完全相同。",
          "qas": [
            {
              "id": "3-72-5",
              "question": "为什么不希望克隆后的虚拟机与原虚拟机配置完全相同？",
              "answers": [
                {
                  "text": "例如，我们并不希望两台虚拟的MAC地址相同，因为这会造成局域网内MAC地址冲突。此外，还有一些牵扯到网卡的配置文件等，我们也不希望克隆后的虚拟机和克隆前的虚拟机完全相同",
                  "answer_start": 227
                }
              ]
            }
          ]
        },
        {
          "context": "想要看虚拟机的一些硬件信息，我们可以查看KVM虚拟机的配置文件，该文件通常位于/etc/libvert/qemu/目录下。KVM会为每个虚拟机生成一个配置文件，配置文件内含有MAC地址等信息。我们可以打开克隆前和克隆后的虚拟机配置文件，查看它们的MAC地址、UUID等信息。可以明显发现，KVM有着很人性化的一点就是会帮助克隆后的虚拟机自动生成新的UUID和MAC地址，因此，我们的虚拟机一经克隆，就立刻可以使用了。注意：1、关于克隆后的虚拟机IP地址，如果不是DHCP的话还需要更改一下。2、如果KVM虚拟机是CentOS6，那么虚拟机的克隆会出现一些问题，我们在后面会涉及到这一部分。",
          "qas": [
            {
              "id": "3-72-6",
              "question": "KVM虚拟机的配置文件通常位于哪个目录？",
              "answers": [
                {
                  "text": "/etc/libvert/qemu/",
                  "answer_start": 66
                }
              ]
            },
            {
              "id": "3-72-7",
              "question": "配置文件内含有哪些信息？",
              "answers": [
                {
                  "text": "MAC地址等信息",
                  "answer_start": 107
                }
              ]
            },
            {
              "id": "3-72-8",
              "question": "KVM克隆后会自动生成哪些新信息？",
              "answers": [
                {
                  "text": "新的UUID和MAC地址",
                  "answer_start": 194
                }
              ]
            },
            {
              "id": "3-72-9",
              "question": "克隆后的虚拟机IP地址需要注意什么？",
              "answers": [
                {
                  "text": "如果不是DHCP的话还需要更改一下",
                  "answer_start": 265
                }
              ]
            },
            {
              "id": "3-72-10",
              "question": "哪种系统的KVM虚拟机克隆可能会出现问题？",
              "answers": [
                {
                  "text": "CentOS6",
                  "answer_start": 315
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}