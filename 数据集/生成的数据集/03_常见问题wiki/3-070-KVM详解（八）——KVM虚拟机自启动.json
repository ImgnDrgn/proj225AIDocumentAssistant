{
  "data": [
    {
      "title": "KVM详解（八）——KVM虚拟机自启动",
      "paragraphs": [
        {
          "context": "在有些场景下，我们需要设置KVM的虚拟机随着宿主机的启动，而自行启动。KVM的虚拟机自启动设置很简单，只需要执行命令：virsh autostart 【虚拟机名称】。但是，在实际配置中，我们往往遇上很多“坑”，这大多是由于一些细节没有注意而导致的，今天，我就对KVM虚拟机的自启动设置进行详细说明。",
          "qas": [
            {
              "id": "3-70-1",
              "question": "KVM虚拟机自启动的简单设置命令是什么？",
              "answers": [
                {
                  "text": "virsh autostart 【虚拟机名称】",
                  "answer_start": 57
                }
              ]
            }
          ]
        },
        {
          "context": "要实现KVM虚拟机在物理机开启后能够自动启动运行，那么我们必须要设置libvirt（KVM的虚拟化服务）服务自动开启。否则，我们的KVM虚拟机会由于libvirt服务没有启动而启动失败。libvert服务设置自启动命令为：systemctl enable libvirtd。",
          "qas": [
            {
              "id": "3-70-2",
              "question": "为了让KVM虚拟机随物理机启动而自动运行，需要设置哪个服务自动开启？",
              "answers": [
                {
                  "text": "libvirt（KVM的虚拟化服务）",
                  "answer_start": 39
                }
              ]
            },
            {
              "id": "3-70-3",
              "question": "设置libvirt服务自启动的命令是什么？",
              "answers": [
                {
                  "text": "systemctl enable libvirtd",
                  "answer_start": 139
                }
              ]
            }
          ]
        },
        {
          "context": "接下来，由于我们在虚拟机安装时，为KVM虚拟机的镜像单独设置了一块磁盘，这样，如果我们在虚拟机启动时，光盘没有挂载，那么KVM虚拟机由于找不到镜像文件，也会启动失败。因此，我们必须设置在开机后，虚拟机镜像必须存在，如果您设置是虚拟机镜像就存放在启动磁盘中，那么可以跳过这一步。但是如果您的虚拟机镜像文件存放在另一块磁盘中，必须挂载才能使用的话，就必须设置虚拟机镜像磁盘自动挂载。要设置磁盘自动挂载，需要打开/etc/fstab文件，在文件最下方增加配置如下：/dev/sdb1 /var/lib/libvirt/images xfs defaults 0 0。对上述配置不知道含义的，可以参考以下文章：Linux磁盘管理实战，相信您一定会有所收获！",
          "qas": [
            {
              "id": "3-70-4",
              "question": "为什么需要设置虚拟机镜像磁盘自动挂载？",
              "answers": [
                {
                  "text": "如果虚拟机镜像文件存放在另一块磁盘中，必须挂载才能使用，若不设置自动挂载，虚拟机启动时可能因找不到镜像文件而启动失败",
                  "answer_start": 78
                }
              ]
            },
            {
              "id": "3-70-5",
              "question": "设置磁盘自动挂载需要修改哪个文件？",
              "answers": [
                {
                  "text": "/etc/fstab",
                  "answer_start": 336
                }
              ]
            },
            {
              "id": "3-70-6",
              "question": "在/etc/fstab文件中增加的磁盘自动挂载配置是什么？",
              "answers": [
                {
                  "text": "/dev/sdb1 /var/lib/libvirt/images xfs defaults 0 0",
                  "answer_start": 365
                }
              ]
            }
          ]
        },
        {
          "context": "之后，我们需要设置虚拟机自启动，假设我们要设置centos7-1.qcow2的虚拟机自启动，那么我们需要执行命令：virsh autostart centos7-1.qcow2。这样，该虚拟机就会在系统启动后自启动了。",
          "qas": [
            {
              "id": "3-70-7",
              "question": "设置centos7-1.qcow2虚拟机自启动的命令是什么？",
              "answers": [
                {
                  "text": "virsh autostart centos7-1.qcow2",
                  "answer_start": 85
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}